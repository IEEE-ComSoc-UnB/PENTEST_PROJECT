#!/bin/bash
# Python script that sends network adms about deauthentication attacks after
# they`re already spotted.
# Usage: $python3 sendMail.py <recipents email address> <AP's Mac address>
#
# Author: JoÃ£o Fiuza de Alencastro - Date: 20/06/18
# Bibliographic reference - Automate the Boring Stuff with Python:
# Practical Programming for Total Beginners, Al Sweigart

import smtplib, getpass
import re, os, sys

def switch_server(argument):
    servers = {
        1: "smtp.live.com",
        2: "smtp.gmail.com"
    }
    return (servers.get(argument, "Invalid server"))

def clear_screen():
    os.system('cls' if os.name == 'nt' else 'clear')

# clear screen
clear_screen()

# User interaction
print('Select SMTP server below:')
print('1 - Outlook/Hotmail')
print('2 - Gmail')

# Validation loop
while True:
    try:
        user_option = int(input("Choose an option: "))
    except ValueError:
        print("Please choose an valid option.")
        continue
    else:
        if not (user_option == 1 or user_option == 2):
            print("Please choose an valid option.")
            pass
        else:
            # valid user option, leaves loop
            server = switch_server(user_option)
            break

smtpObj = smtplib.SMTP(server, 587)

# Established connection to the smtp server - code 250 -> OK
smtpObj.ehlo()

# Starting TLS encryption - code 220 -> server ready
smtpObj.starttls()

# clear screen
clear_screen()

# Logging in to the SMTP server - code 235 -> Authentication successful
# Simple regex validation for email input
email = input("Please, input your e-mail address: ")
while not re.match(r"[^@]+@[^@]+\.[^@]+", email):
    print("Invalid address")
    email = input("Please, input your e-mail address: ")
#pswd = input("Input password: ")

pswd = getpass.getpass()

login_code = smtpObj.login(email, pswd)
if login_code[0] != 235:
    print("Login attempt failed, SMTP server could not authenticate address")
else:
    print("Login successful")

if len(sys.argv) < 2:
	recipient = input('Input recipient e-mail address: ')
	content = input("Input AP's MAC: ")
elif len(sys.argv) == 2:
	recipient = sys.argv[1]
	content = input("Input AP's MAC: ")
else:
	recipient = sys.argv[1]
	content = sys.argv[2]

content = "Subject: Access Point " + str(content) + " deauthentication attack detected."

smtpObj.sendmail(email, recipient, content)

smtpObj.quit()
