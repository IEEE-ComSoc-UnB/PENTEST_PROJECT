#!/usr/bin/python3
import socket
import os

HOST = "127.0.0.1" # Configuracao da variavel de ambiente do endereco do host utilizado pelo servidor
PORT = 6789        # A porta que sera utilizada pelo servidor 


# Inicializacao de um socket com a funcao socket
with socket.socket(socket.AF_INET,socket.SOCK_STREAM) as s:

    # "binda" o socket criado ao endereco e porta configurados anteriormente
    s.bind((HOST,PORT))

    # informacoes para gerencia
    time=os.popen("date").read()
    time=time.strip('\n')
    print("{0} - Socket intialized: {1}:{2}".format(time,HOST,PORT))

    # faz com que o socket fique esperando novas conexoes
    s.listen()

    # quando uma nova conexao Ã© realizada a funcao accept retorna um objeto conn que possui como caracteristicas IP e porta
    conn, addr = s.accept()
    
    # cria uma instacia de processamento associada as informacoes daquela conexao
    with conn:
        print("Connection with {0} intialized.".format(addr))
        while True:
            dados = conn.recv(1024)
            if not dados:
                break
            conn.sendall(dados)


